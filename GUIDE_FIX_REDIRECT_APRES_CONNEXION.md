# üîß Guide : Corriger la redirection apr√®s connexion

## üîç Probl√®me
Apr√®s une connexion r√©ussie (email/password ou OAuth), l'utilisateur est redirig√© vers la page d'accueil `/` au lieu du dashboard `/dashboard`.

## ‚úÖ Solution

### 1. V√©rifier la configuration Supabase (Dashboard)

Allez sur votre dashboard Supabase :
1. **Authentication** ‚Üí **URL Configuration**
2. V√©rifiez les URL suivantes :

#### **Site URL (Production)**
```
https://votre-app.vercel.app
```
OU
```
https://votre-domaine.com
```

#### **Redirect URLs (Autoris√©es)**
Ajoutez ces URL :
```
http://localhost:3001/auth/callback
https://votre-app.vercel.app/auth/callback
https://votre-domaine.com/auth/callback
```

### 2. V√©rifier les providers OAuth

#### **Google OAuth**
Dans Google Cloud Console :
- **Authorized redirect URIs** doit contenir :
  ```
  https://qkpfxpuhrjgctpadxslh.supabase.co/auth/v1/callback
  https://votre-app.vercel.app/auth/callback
  ```

#### **Microsoft Azure OAuth**
Dans Azure App Registrations :
- **Redirect URIs** doit contenir :
  ```
  https://qkpfxpuhrjgctpadxslh.supabase.co/auth/v1/callback
  https://votre-app.vercel.app/auth/callback
  ```

### 3. Variables d'environnement Vercel

Dans Vercel ‚Üí Settings ‚Üí Environment Variables :
```bash
NEXT_PUBLIC_BASE_URL=https://votre-app.vercel.app
# OU
NEXT_PUBLIC_BASE_URL=https://votre-domaine.com
```

### 4. Tester la connexion

#### **Test connexion email/password :**
1. Allez sur `/auth/login`
2. Connectez-vous avec email et mot de passe
3. Vous devriez √™tre redirig√© vers `/dashboard`

#### **Test connexion OAuth :**
1. Allez sur `/auth/login`
2. Cliquez sur "Continuer avec Google" ou "Microsoft"
3. Autorisez l'application
4. Vous devriez √™tre redirig√© vers `/auth/callback`
5. Puis automatiquement vers `/dashboard`

## üêõ Si √ßa ne fonctionne toujours pas

### V√©rifier les logs Vercel
1. Allez dans **Deployments** sur Vercel
2. Cliquez sur le dernier d√©ploiement
3. Allez dans **Function Logs**
4. Cherchez les erreurs li√©es √† `/auth/callback`

### V√©rifier les cookies
1. Ouvrez les DevTools (F12)
2. **Application** ‚Üí **Cookies**
3. V√©rifiez que les cookies Supabase sont pr√©sents :
   - `sb-access-token`
   - `sb-refresh-token`

### Forcer la redirection c√¥t√© client

Si le probl√®me persiste, vous pouvez forcer la redirection dans le callback en modifiant `app/auth/callback/route.ts` :

```typescript
// Au lieu de :
return NextResponse.redirect(`${origin}/dashboard`)

// Essayez :
return NextResponse.redirect(`${origin}/dashboard`, { status: 302 })
```

## ‚úÖ Checklist finale

- [ ] Site URL configur√© dans Supabase
- [ ] Redirect URLs ajout√©es dans Supabase
- [ ] Google OAuth Redirect URIs configur√©es
- [ ] Azure OAuth Redirect URIs configur√©es
- [ ] NEXT_PUBLIC_BASE_URL dans Vercel
- [ ] Test connexion email/password OK
- [ ] Test connexion OAuth OK

